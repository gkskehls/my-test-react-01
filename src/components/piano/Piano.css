.piano {
    display: flex;
    position: relative;
    padding: 10px;
    border-radius: 10px;
    background-color: #333;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
    margin-top: 2rem;
    box-sizing: border-box;

    /* 화면보다 건반이 길어질 경우 가로 스크롤을 허용합니다. */
    overflow-x: auto;
    -webkit-overflow-scrolling: touch; /* iOS에서 부드러운 스크롤을 위함 */
    overscroll-behavior-x: contain; /* 가로 스크롤 시 페이지 전체 스크롤 방지 */

    max-width: 860px;
    width: 100%;
}

.key-container {
    position: relative;
    /*
     * 화면이 넓을 때는 건반이 영역을 꽉 채우도록 너비를 유연하게 계산하고,
     * 화면이 좁아져 계산된 너비가 50px보다 작아지면 최소 너비(50px)를 보장합니다.
     * var의 두 번째 인자는 --num-white-keys 변수가 없을 경우의 기본값입니다.
     */
    width: max(50px, calc(100% / var(--num-white-keys, 14)));
    flex-shrink: 0; /* 컨테이너 너비가 줄어들어도 건반 너비가 줄어들지 않도록 설정 */
}

.key {
    cursor: pointer;
    border: 1px solid #000;
    box-shadow: inset 0 -2px 5px rgba(0, 0, 0, 0.3);
    box-sizing: border-box;
    transition: background-color 0.1s, box-shadow 0.1s, transform 0.05s ease-out;
}

.key-note-name {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 14px;
    font-weight: bold;
    pointer-events: none;
    user-select: none;
    /* 계이름이 길어질 경우 줄바꿈되는 것을 방지합니다. */
    white-space: nowrap;
}

.white-key .key-note-name {
    color: #888;
}

.black-key .key-note-name {
    color: #ccc;
    font-size: 12px;
}

/* 한국어 계이름('도#')은 영어('C#')보다 폭이 넓으므로,
 * 한국어일 때 검은 건반의 글씨 크기를 약간 줄여 자연스럽게 보이도록 합니다. */
:root[lang="ko"] .black-key .key-note-name {
    font-size: 11px;
}

.key:active,
.key.active {
    /* ✨ CSS 변수를 사용하여 테마와 일관된 활성 색상을 적용합니다. */
    background-color: var(--accent-primary);
    /* ✨ 활성 상태일 때 그림자를 좀 더 어둡게 하여 깊이감을 줍니다. */
    box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5), inset 0 -2px 5px rgba(0, 0, 0, 0.3);
}

/* ✨ 활성 상태일 때 계이름 색상을 변경하여 가독성을 높입니다. */
.key.active .key-note-name {
    color: var(--accent-text);
    /* 그림자 효과를 살짝 주어 텍스트를 더 돋보이게 합니다. */
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

/* ✨ 1. 다음에 눌러야 할 건반(가이드 키)에 대한 스타일을 정의합니다. */
@keyframes pulse-guide {
    0% {
        box-shadow: 0 0 10px 2px var(--guide-color-glow);
    }
    50% {
        box-shadow: 0 0 18px 5px var(--guide-color-glow);
    }
    100% {
        box-shadow: 0 0 10px 2px var(--guide-color-glow);
    }
}

.key.guide {
    /* ✨ 2. 가이드 키의 배경색과 함께, 은은하게 깜빡이는 애니메이션을 적용합니다. */
    background-color: var(--guide-color-bg);
    animation: pulse-guide 2s infinite ease-in-out;
}

.white-key {
    width: 100%; /* 부모인 .key-container의 너비를 항상 100% 채웁니다. */
    height: 240px;
    background-color: white;
    border-radius: 0 0 5px 5px;
    position: relative; /* z-index가 동작하도록 position 추가 */
    z-index: 1;
}

.white-key:active,
.white-key.active {
    transform: translateY(2px);
}

.black-key {
    /* 너비는 고정값 또는 %로 설정할 수 있습니다. */
    width: 60%;
    max-width: 38px;
    height: 140px;
    background: linear-gradient(to bottom, #444, #222);
    border-radius: 0 0 3px 3px;
    position: absolute;
    z-index: 2;
    top: 0; /* 부모 컨테이너의 상단에 위치하도록 명시합니다. */
    left: 100%;
    transform: translateX(-50%);
}

.black-key:active,
.black-key.active {
    transform: translateX(-50%) translateY(2px);
}

/* 미디어 쿼리는 이제 건반 높이만 조절하면 됩니다. */
@media (max-width: 768px) {
    .white-key {
        height: 180px;
    }
    .black-key {
        height: 100px;
    }
}

@media (max-width: 480px) {
    .white-key {
        height: 150px;
    }
    .black-key {
        height: 80px;
    }
}